<!DOCTYPE html>
<html>
<head>
 <title></title>
 <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css" />
 <style type="text/css">
	#grid-system { margin-left: 100px; }
	.item { margin-bottom: 8px; }
	.icon-chevron-right { margin: 3px 3px 0 0; }
 </style>
</head>
<body>
	<section id="grid-system">
		<div class="page-header"><h1></h1></div>
		<div id="news"></div>
		<hr />
		<div id="footer">
			<p>This page is styled after <a href="http://scripting.com/">Dave Winer</a>'s <a href="http://daveriver.scripting.com/">River of News</a>. It's built with <a href="http://jquery.com">jQuery</a> and <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>, and gets its data from <a href="http://grabbit.lucasrichter.id.au/">Grabbit</a>.</p>
		</div>
	</section>
	<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
	<script type="text/javascript">
	var RoN = {};
	$(function(){
    SubdomainTitleMap = {
      'reading': "Lucas's Reading List",
      'links': "Lucas's Linkblog"
    };
	  RoN = {
	  tag: '',
		sourceURL: '/download_jobs/tagged/{TAG}/feed',
		maxItemsToDisplay: 100,
		addItems: function(items) {
		  $.each(items.reverse(), function() {
		    if ($('#ronItem_' + this.id).length) return;
			jQuery('<div/>', {
			    class: 'item row',
				id: 'ronItem_' + this.id
			  }).append(jQuery('<h3/>', {
				class: 'span10 offset1'
			  }).append(jQuery('<span/>', {
				class: 'icon-chevron-right'
			  })).append(jQuery('<a/>', {
				href: this.url,
				text: this.title,
				title: this.title,
				target: '_blank'
			  }))
			).prependTo('#news');
		  });
		},
		getNewItems: function() {
		  console.log('Getting new items...');
		  $.ajax({
			url: this.sourceURL.replace('{TAG}', this.tag),
			success: this.addItems,
			dataType: 'json'
		  });
		  console.log('Done getting new items.');
		},
		removeOldItems: function() {},
    startEverything: function() {
      var t = location.href.match(/:\/\/([^\.])+[\.\/]/)[0];
		  this.tag = t.substr(3,t.length-4);
      $('.page-header h1').text(SubdomainTitleMap[this.tag]);
      document.title = SubdomainTitleMap[this.tag];
      this.getNewItems();
		  window.setInterval(RoN.getNewItems, 300000);
    }
	  };
	  RoN.startEverything();
	});
 </script>
</body>
</html>
